# 关于渲染性能优化

* 避免重复渲染

## 1、requestAnimationFrame(func(time))

* ​	该函数类似于定时器，传入一个回调函数（本来是用于传入一个动画），在浏览器下一次重绘之前调用该函数。时间间隔一般是16.7ms(取决于显示屏刷新率)，也就是1000/60，因为大多数显示屏都是60帧的刷新率。

* ​    该函数还会自动对回调函数添加一个参数，用于表示在何时调用该回调函数。如果需要降低函数调用的频率，可以获取该事件并进行条件判断。

* ​    对于要实现（优化）动画效果，应该在回调函数中再次调用requestAnimationFrame()，达到重复更新。

### 优势

1、函数节流，该函数会把这一帧中的所有重绘/回流操作，整合成一次。相对于定时器方法，该函数可以避免丢帧现象。因为数值更新操作固定按照屏幕刷新前来进行。

2、如果把网页调换到后台不显示，该函数将不再调用，而计时器却会一直进行，造成CPU的资源浪费。

## 2、保持dom操作的原子性

​		**浏览器对于一段代码中频繁改变的样式(颜色、边框)，并不会每一次都会发生重绘/回流，而是会维持一个队列。经过一定时间或者队列长度，才会对队列中的操作flush，整合成一次操作，减少dom的修改次数**

> ​	**但对于一些特殊情况则会立即去flush队列，对性能造成影响。如：**
>
> > 1. offsetTop, offsetLeft, offsetWidth, offsetHeight
> >
> > 2. scrollTop/Left/Width/Height
> > 3. clientTop/Left/Width/Height
> > 4. width,height
> > 5. 请求了getComputedStyle(), 或者 ie的 currentStyle

> **因为要给用户获取到最精确的值**

​	因此，在一段代码中，应尽量保证把获取dom元素参数的代码放在一起，修改dom元素参数的代码放在一起。而不是获取一个修改一个、获取一个修改一个，这样会造成多次布局计算。

![image-20200916111732799](C:\Users\pc\AppData\Roaming\Typora\typora-user-images\image-20200916111732799.png)

## 3、使用classList，而非className来修改dom样式

​	className每修改一次就会造成一次渲染布局。

​	classList则浏览器会先去进行样式名的判断，再进行渲染布局，以减少不必要的重复渲染。

